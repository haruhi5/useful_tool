<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>USD / SGD / CNY Converter</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 420px;
      margin: 40px auto;
    }
    h1 {
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
    }
    .card {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 16px;
    }
    .row {
      margin: 8px 0;
    }
    label {
      display: block;
      margin-bottom: 4px;
      font-size: 0.9rem;
    }
    select, input[type="number"] {
      width: 100%;
      padding: 6px 8px;
      box-sizing: border-box;
    }
    button {
      padding: 6px 12px;
      margin-top: 8px;
      cursor: pointer;
    }
    .result {
      margin-top: 12px;
      padding-top: 8px;
      border-top: 1px solid #eee;
    }
    .rate-row {
      font-size: 0.9rem;
      color: #555;
    }
    #status {
      font-size: 0.85rem;
      color: #666;
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <h1>USD / SGD / CNY Converter</h1>
  <div class="card">
    <div class="row">
      <button id="refreshBtn">Refresh Rates</button>
    </div>

    <div class="row">
      <label for="baseCurrency">Input currency:</label>
      <select id="baseCurrency">
        <option value="USD">USD</option>
        <option value="SGD">SGD</option>
        <option value="CNY">CNY</option>
      </select>
    </div>

    <div class="row">
      <label for="amount">Amount:</label>
      <input type="number" id="amount" value="1" min="0" step="0.01">
      <button id="convertBtn">Convert</button>
    </div>

    <div class="result">
      <div>USD: <strong><span id="outUsd">-</span></strong></div>
      <div>SGD: <strong><span id="outSgd">-</span></strong></div>
      <div>CNY: <strong><span id="outCny">-</span></strong></div>
    </div>

    <div class="result">
      <div class="rate-row">1 USD = <span id="rateUsdSgd">-</span> SGD</div>
      <div class="rate-row">1 USD = <span id="rateUsdCny">-</span> CNY</div>
      <div class="rate-row">1 SGD = <span id="rateSgdCny">-</span> CNY</div>
    </div>

    <div id="status"></div>
  </div>

  <script>
    let usdToSgd = null;
    let usdToCny = null;

    async function fetchRates() {
      const status = document.getElementById('status');
      const convertBtn = document.getElementById('convertBtn');
      status.textContent = 'Loading rates...';
      convertBtn.disabled = true;

      try {
        // Get USD -> SGD, CNY
        const res = await fetch('https://api.frankfurter.app/latest?base=USD&symbols=SGD,CNY');
        if (!res.ok) throw new Error('Rate fetch failed');
        const data = await res.json();

        usdToSgd = data.rates.SGD;
        usdToCny = data.rates.CNY;

        // Display base rates
        document.getElementById('rateUsdSgd').textContent = usdToSgd.toFixed(4);
        document.getElementById('rateUsdCny').textContent = usdToCny.toFixed(4);

        // Derived 1 SGD -> CNY
        const sgdToCny = usdToCny / usdToSgd;
        document.getElementById('rateSgdCny').textContent = sgdToCny.toFixed(4);

        status.textContent = 'Rates loaded (date: ' + data.date + ')';
        convertBtn.disabled = false;

        // Auto-convert current values
        convert();
      } catch (e) {
        console.error(e);
        status.textContent = 'Error fetching rates.';
      }
    }

    function convert() {
      const status = document.getElementById('status');
      if (usdToSgd === null || usdToCny === null) {
        status.textContent = 'Rates not loaded yet. Click "Refresh Rates".';
        return;
      }

      const baseCurrency = document.getElementById('baseCurrency').value;
      const amountInput = document.getElementById('amount');
      let amount = parseFloat(amountInput.value);
      if (isNaN(amount) || amount < 0) {
        amount = 0;
      }

      // Convert via USD as pivot
      let amountInUsd;
      if (baseCurrency === 'USD') {
        amountInUsd = amount;
      } else if (baseCurrency === 'SGD') {
        amountInUsd = amount / usdToSgd;
      } else { // CNY
        amountInUsd = amount / usdToCny;
      }

      const usd = amountInUsd;
      const sgd = amountInUsd * usdToSgd;
      const cny = amountInUsd * usdToCny;

      document.getElementById('outUsd').textContent = usd.toFixed(2);
      document.getElementById('outSgd').textContent = sgd.toFixed(2);
      document.getElementById('outCny').textContent = cny.toFixed(2);
    }

    document.getElementById('refreshBtn').addEventListener('click', fetchRates);
    document.getElementById('convertBtn').addEventListener('click', convert);
    document.getElementById('amount').addEventListener('keydown', function (e) {
      if (e.key === 'Enter') {
        convert();
      }
    });
    document.getElementById('baseCurrency').addEventListener('change', convert);

    // Auto-load rates on open
    fetchRates();
  </script>
</body>
</html>
